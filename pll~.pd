#N canvas 0 30 1679 811 12;
#X declare -lib else;
#X obj 6 9 declare -lib else;
#X obj 21 191 else/bandpass~ 7.5 0.707;
#X obj 209 192 else/bandpass~ 480 0.707;
#X obj 22 580 outlet~;
#X obj 79 580 outlet~;
#X obj 22 41 inlet~;
#X obj 404 36 inlet;
#X obj 801 40 inlet;
#X obj 917 32 inlet;
#X text 1057 12 initial frequency;
#X text 1198 10 phase update (0-1);
#X text 1335 10 freq update (0-1);
#X obj 530 35 loadbang;
#X obj 562 88 samplerate~;
#X obj 576 168 /;
#X msg 562 142 1;
#X obj 562 115 t b f;
#X text 556 386 a phasor (0-1) in $y1;
#X text 1003 252 Inputs to the frequency parameter trigger an update
;
#X text 1009 274 to the frequency immediately;
#X obj 1095 41 inlet;
#X obj 1215 41 inlet;
#X text 402 10 time constant (ms);
#X obj 1365 41 inlet;
#X obj 20 252 fexpr~ $f3*$y1+$x1^2 \; $f3*$y2+$x1*$x2;
#X obj 530 60 t b b;
#X text 604 167 1/samplerate;
#X obj 404 193 expr exp(-1000.0*$f2/$f1);
#X text 178 257 |Lx|^2 in $y1;
#X text 179 274 (Lx)*(Hx) in $y2;
#X text 555 412 its frequency in $y2;
#X text 758 19 lambda \, threshold;
#X obj 186 32 inlet;
#X obj 291 36 inlet;
#X text 186 9 f low;
#X text 288 11 f high;
#X obj 186 75 f \$1;
#X obj 291 72 f \$2;
#X obj 404 165 f \$3;
#X obj 801 126 f \$4;
#X obj 917 118 f \$5;
#X obj 1215 130 f \$7;
#X obj 1365 124 f \$8;
#X obj 1095 127 f \$6;
#X obj 186 109 * 0.25;
#X obj 291 111 * 4;
#X obj 801 151 t f f;
#X obj 801 176 * 0;
#X text 738 175 lambda^2;
#X text 900 10 adaptive coeff (0-1);
#X text 554 435 measured freq \, r \, in $y3;
#X text 552 480 2nd derivative term \, g in $y5;
#X text 553 503 thresholding function of g in $y6;
#X msg 1005 155 set y2 \$1;
#X text 555 364 what is being tracked inside this fexpr:;
#X obj 937 550 fexpr~ $x1^2*$x2[-3]+$x3[-3];
#X text 1147 549 raw error signal \, e(t);
#X text 607 188 $f5;
#X text 829 175 $f6;
#X text 917 141 $f7;
#X text 1225 153 $f8;
#X text 1381 148 $f9;
#X text 556 528 rLx in $y7;
#X text 184 293 x in $y3;
#X text 182 310 Lx in $y4;
#X text 554 460 est phase p - $x1 in $y4;
#X text 561 550 wrap $y4 between -0.5 \, 0.5 in $y8;
#X obj 148 576 outlet~;
#X obj 210 577 outlet~;
#X obj 273 577 outlet~;
#X text 272 601 measure for lambda;
#X obj 366 555 outlet~;
#X obj 436 582 outlet~;
#X obj 938 593 outlet~;
#X obj 23 360 fexpr~ modf($y1+$f5*$y2+$f8*$y8) \; $y2+$f9*($y3-$y2)
\; $y3 - $y3[-3]*$f7*$y6*($y3[-3]^2*$x1[-3] + $x2[-3]) \; if($y7>=0
\, atan2($y7 \, $x3) \, atan2($y7 \, $x3)+6.28318)/6.28318-$y1 \; 3*$y3^2*$x1
+ $x2 \; $y5/($y5^2+$f6) \; $y3*$x4 \; if($y4<-0.5 \, 1+$y4 \, if($y4<0.5
\, $y4 \, $y4-1)), f 70;
#X msg 532 251 set y3 10 10 10 10;
#X connect 1 0 24 0;
#X connect 1 0 55 1;
#X connect 1 0 74 3;
#X connect 2 0 24 1;
#X connect 2 0 55 2;
#X connect 5 0 1 0;
#X connect 5 0 2 0;
#X connect 5 0 74 2;
#X connect 6 0 38 0;
#X connect 7 0 39 0;
#X connect 8 0 40 0;
#X connect 12 0 25 0;
#X connect 12 0 75 0;
#X connect 12 0 36 0;
#X connect 12 0 37 0;
#X connect 12 0 39 0;
#X connect 12 0 40 0;
#X connect 12 0 43 0;
#X connect 12 0 41 0;
#X connect 12 0 42 0;
#X connect 13 0 16 0;
#X connect 14 0 27 1;
#X connect 14 0 74 4;
#X connect 15 0 14 0;
#X connect 16 0 15 0;
#X connect 16 1 14 1;
#X connect 20 0 43 0;
#X connect 21 0 41 0;
#X connect 23 0 42 0;
#X connect 24 0 74 0;
#X connect 24 1 74 1;
#X connect 25 0 38 0;
#X connect 25 1 13 0;
#X connect 27 0 24 2;
#X connect 32 0 36 0;
#X connect 33 0 37 0;
#X connect 36 0 44 0;
#X connect 37 0 45 0;
#X connect 38 0 27 0;
#X connect 39 0 46 0;
#X connect 40 0 74 6;
#X connect 41 0 74 7;
#X connect 42 0 74 8;
#X connect 43 0 53 0;
#X connect 44 0 1 1;
#X connect 45 0 2 1;
#X connect 46 0 47 0;
#X connect 46 1 47 1;
#X connect 47 0 74 5;
#X connect 53 0 74 0;
#X connect 55 0 73 0;
#X connect 74 0 3 0;
#X connect 74 1 4 0;
#X connect 74 2 55 0;
#X connect 74 2 67 0;
#X connect 74 4 69 0;
#X connect 74 5 71 0;
#X connect 74 6 72 0;
#X connect 74 7 68 0;
#X connect 75 0 74 0;
