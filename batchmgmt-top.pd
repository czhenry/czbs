#N canvas 2 317 956 481 10;
#X declare -path ggee;
#X declare -path shmem;
#X text 573 65 batchmgmt-top and batchmgmt-sub use the following shmemID's
;
#X text 573 84 10999 - set to 0 (default) when editing. If non-zero
\, batchmgmt-sub will set value 1 to shmemID 10998 and stop.;
#X text 573 112 10998 - batchmgmt-top reads from 10998 to find if a
batchmgmt-sub instance has started (value 1).;
#X text 573 232 10996 - batchmgmt-top reads the shmemID y and uses
(y \, y+1000) to receive messages from batchmgmt-sub.;
#X text 572 260 10995 - placeholder for shmem initial config;
#X text 573 140 10997 - batchmgmt-top will assign a new shmemID x to
10997 and send SIGCONT to the pd instance with batchmgmt-sub. batchmgmt-sub
will read on 10997 the first time it receives a CONT and will assign
(x \, x+1000) for reading from batchmgmt-top. It will assign (x+2000
\, x+3000) for writing messages back to batchmgmt-top. It will set
x+2000 to shmemID 10996 and stop.;
#X text 577 281 For each batch process it will dynamically assign shmemID's
in sequence. 4 shmemID's will be needed for each process. The first
shmemID's are;
#X obj 351 87 tgl 15 0 \$0-edit_mode empty empty 17 7 0 10 -262144
-1 -1 0 1;
#X text 368 86 edit mode;
#X obj 14 401 inlet;
#X text 578 326 11001-lenth of message to send to batchmgmt-sub;
#X text 578 341 12001-FUDI protocol message data sent;
#X text 578 357 13001-length of messages received from batchmgmt-sub
;
#X text 578 373 14001-FUDI protocal message data received;
#X obj 252 134 nbx 5 14 25 1000 0 1 \$0-poll-ms empty empty 0 -8 0
10 -262144 -1 -1 100 256;
#X text 308 133 polling interval ms;
#X obj 253 160 tgl 15 0 \$0-poll-procs \$0-poll-procs-in empty 17 7
0 10 -262144 -1 -1 1 1;
#X obj 59 87 bng 15 250 50 0 \$0-op-bang empty empty 17 7 0 10 -262144
-1 -1;
#X text 76 86 choose patch;
#X symbolatom 60 107 60 0 0 0 - #0-pathname -;
#X obj 60 139 bng 15 250 50 0 \$0-start empty empty 17 7 0 10 -262144
-1 -1;
#X text 77 138 start batch process;
#X obj 60 164 bng 15 250 50 0 \$0-send_TSTP empty empty 17 7 0 10 -262144
-1 -1;
#X obj 60 189 bng 15 250 50 0 \$0-send_TERM empty empty 17 7 0 10 -262144
-1 -1;
#X text 58 279 receive messages;
#X obj 60 259 nbx 5 14 -1e+37 1e+37 0 0 empty \$0-pid empty 0 -8 0
10 -262144 -1 -1 0 256;
#X text 117 259 PID;
#X text 26 14 usage: batchmgmt-top [patch.pd] [1];
#X text 579 18 batchmgmt-top is an abstraction to start and communicate
with batch pd processes using shell \, FUDI over shmem \, and signal
handlers sigtstp \, sigcont \, and raisestop.;
#X text 394 274 stdout;
#X text 78 188 send TERM signal (Ctrl-C);
#X obj 60 215 bng 15 250 50 0 \$0-send_KILL empty empty 17 7 0 10 -262144
-1 -1;
#X text 78 214 send KILL signal;
#X text 78 162 send TSTP signal (Ctrl-Z);
#X obj 171 259 nbx 5 14 -1e+37 1e+37 0 0 empty \$0-idtxl empty 0 -8
0 10 -262144 -1 -1 0 256;
#X obj 171 280 nbx 5 14 -1e+37 1e+37 0 0 empty \$0-idtxd empty 0 -8
0 10 -262144 -1 -1 0 256;
#X obj 231 258 nbx 5 14 -1e+37 1e+37 0 0 empty \$0-idrxl empty 0 -8
0 10 -262144 -1 -1 0 256;
#X obj 231 280 nbx 5 14 -1e+37 1e+37 0 0 empty \$0-idrxd empty 0 -8
0 10 -262144 -1 -1 0 256;
#X text 169 239 shmem Tx;
#X text 232 239 Rx;
#N canvas 1030 85 489 222 send_signals 0;
#X obj 20 160 ggee/shell;
#X msg 20 93 kill -CONT \$1;
#X obj 20 66 f 0;
#X obj 35 38 r \$0-pid;
#X obj 11 16 r \$0-send_CONT;
#X obj 220 66 f 0;
#X obj 235 38 r \$0-pid;
#X obj 120 66 f 0;
#X obj 135 38 r \$0-pid;
#X obj 111 16 r \$0-send_TSTP;
#X msg 120 93 kill -TSTP \$1;
#X obj 211 16 r \$0-send_TERM;
#X msg 220 93 kill -TERM \$1;
#X obj 320 66 f 0;
#X obj 335 38 r \$0-pid;
#X obj 311 16 r \$0-send_KILL;
#X msg 320 93 kill -KILL \$1;
#X msg 123 161 1;
#X msg 214 161 0;
#X obj 214 184 s \$0-suspended;
#X obj 123 184 s \$0-running;
#X connect 1 0 0 0;
#X connect 2 0 1 0;
#X connect 3 0 2 1;
#X connect 4 0 2 0;
#X connect 4 0 18 0;
#X connect 4 0 17 0;
#X connect 5 0 12 0;
#X connect 6 0 5 1;
#X connect 7 0 10 0;
#X connect 8 0 7 1;
#X connect 9 0 7 0;
#X connect 10 0 0 0;
#X connect 11 0 5 0;
#X connect 12 0 0 0;
#X connect 13 0 16 0;
#X connect 14 0 13 1;
#X connect 15 0 13 0;
#X connect 16 0 0 0;
#X connect 17 0 20 0;
#X connect 18 0 19 0;
#X restore 369 402 pd send_signals;
#X obj 191 428 outlet;
#X obj 521 432 outlet;
#N canvas 333 85 693 711 polling_and_read_output 0;
#X obj 100 658 outlet;
#X obj 100 633 fudiparse;
#X obj 266 51 metro 100;
#X obj 370 26 r \$0-poll-ms;
#X obj 305 157 shmem 10998 1;
#X msg 305 120 memread 0;
#X obj 305 180 select 1;
#X msg 232 180 memset 0 0;
#X obj 305 203 t b b;
#X obj 304 236 f 11001;
#X obj 370 350 + 1;
#X obj 304 289 shmem 10997 1;
#X msg 304 262 memset 0 \$1;
#X obj 217 339 t f f;
#X obj 217 440 + 1000;
#X obj 136 160 shmem 10995 1;
#X obj 116 372 shmem 10995 1;
#X msg 217 463 allocate \$1 1024;
#X msg 244 377 allocate \$1 1;
#X msg 505 120 memread 0;
#X msg 432 180 memset 0 0;
#X obj 505 157 shmem 10996 1;
#X obj 505 180 route 0;
#X obj 544 213 t b f;
#X msg 136 125 memread 0;
#X obj 136 183 route 0;
#X obj 116 315 f 0;
#X obj 156 316 + 1;
#X obj 116 289 until;
#X text 97 230 message length;
#X msg 116 338 memread \$1;
#X obj 100 446 list store;
#X msg 116 400 append \$1;
#X obj 53 249 t b b b b f;
#X msg 77 285 0;
#X msg 48 403 bang;
#X msg 50 188 memset 0 0;
#X obj 207 235 s \$0-send_CONT;
#X obj 571 243 s \$0-idrxl;
#X obj 228 404 s \$0-idrxd;
#X obj 216 313 r \$0-idrxl;
#X obj 393 264 s \$0-idtxl;
#X msg 5 437 1;
#X msg 6 487 0;
#X obj 4 463 s \$0-suspended;
#X obj 7 513 s \$0-running;
#X msg 533 262 1;
#X msg 534 312 0;
#X obj 532 288 s \$0-suspended;
#X obj 535 338 s \$0-running;
#X obj 76 51 metro 100;
#X obj 266 75 t b b;
#X obj 266 26 r \$0-poll-procs;
#X obj 180 26 r \$0-poll-ms;
#X obj 76 26 r \$0-poll-msgs;
#X obj 372 519 r global_poll_procs;
#X obj 372 592 spigot 1;
#X msg 372 615 0;
#X obj 372 638 s \$0-poll-procs-in;
#X msg 417 566 1;
#X obj 479 409 r \$0-start;
#X msg 506 471 0;
#X obj 372 542 t b b;
#X obj 479 432 t b b;
#X obj 370 483 s global_poll_procs;
#X obj 354 213 r global_next_shmemid;
#X obj 369 381 s global_next_shmemid;
#X msg 522 518 1;
#X connect 1 0 0 0;
#X connect 2 0 51 0;
#X connect 3 0 2 1;
#X connect 4 0 6 0;
#X connect 5 0 4 0;
#X connect 6 0 8 0;
#X connect 7 0 4 0;
#X connect 8 0 7 0;
#X connect 8 0 37 0;
#X connect 8 1 9 0;
#X connect 9 0 10 0;
#X connect 9 0 12 0;
#X connect 9 0 41 0;
#X connect 10 0 66 0;
#X connect 12 0 11 0;
#X connect 13 0 14 0;
#X connect 13 1 18 0;
#X connect 14 0 17 0;
#X connect 14 0 39 0;
#X connect 15 0 25 0;
#X connect 16 0 32 0;
#X connect 17 0 16 0;
#X connect 18 0 15 0;
#X connect 19 0 21 0;
#X connect 20 0 21 0;
#X connect 21 0 22 0;
#X connect 22 1 23 0;
#X connect 23 0 20 0;
#X connect 23 0 46 0;
#X connect 23 0 47 0;
#X connect 23 1 38 0;
#X connect 24 0 15 0;
#X connect 25 1 33 0;
#X connect 26 0 27 0;
#X connect 26 0 30 0;
#X connect 27 0 26 1;
#X connect 28 0 26 0;
#X connect 30 0 16 0;
#X connect 31 0 1 0;
#X connect 32 0 31 0;
#X connect 33 0 36 0;
#X connect 33 1 35 0;
#X connect 33 2 34 0;
#X connect 33 3 31 0;
#X connect 33 4 28 0;
#X connect 34 0 26 1;
#X connect 35 0 31 1;
#X connect 35 0 42 0;
#X connect 35 0 43 0;
#X connect 36 0 15 0;
#X connect 40 0 13 0;
#X connect 42 0 44 0;
#X connect 43 0 45 0;
#X connect 46 0 48 0;
#X connect 47 0 49 0;
#X connect 50 0 24 0;
#X connect 51 0 5 0;
#X connect 51 1 19 0;
#X connect 52 0 2 0;
#X connect 53 0 50 1;
#X connect 54 0 50 0;
#X connect 55 0 62 0;
#X connect 56 0 57 0;
#X connect 57 0 58 0;
#X connect 59 0 56 1;
#X connect 60 0 63 0;
#X connect 61 0 56 1;
#X connect 62 0 59 0;
#X connect 62 1 56 0;
#X connect 63 0 64 0;
#X connect 63 1 61 0;
#X connect 63 1 67 0;
#X connect 65 0 9 1;
#X connect 67 0 58 0;
#X restore 191 401 pd polling_and_read_output;
#N canvas 2 85 327 711 read_input_and_send_CONT 0;
#X obj 118 220 fudiformat;
#X obj 126 467 t f f;
#X obj 126 564 + 1000;
#X obj 153 534 shmem 10995 1;
#X obj 126 632 shmem 10995 1;
#X msg 126 587 allocate \$1 1024;
#X msg 153 505 allocate \$1 1;
#X obj 118 426 list trim;
#X obj 175 284 list length;
#X obj 118 403 list prepend memset 0;
#X msg 175 307 memset 0 \$1;
#X obj 118 243 t l l;
#X obj 58 169 t b l;
#X obj 20 243 s \$0-send_CONT;
#X obj 58 144 list;
#X obj 191 440 r \$0-idtxl;
#X obj 183 562 s \$0-idtxd;
#X obj 58 97 inlet;
#X connect 0 0 11 0;
#X connect 1 0 2 0;
#X connect 1 1 6 0;
#X connect 2 0 5 0;
#X connect 2 0 16 0;
#X connect 5 0 4 0;
#X connect 6 0 3 0;
#X connect 7 0 4 0;
#X connect 8 0 10 0;
#X connect 9 0 7 0;
#X connect 10 0 3 0;
#X connect 11 0 9 0;
#X connect 11 1 8 0;
#X connect 12 0 13 0;
#X connect 12 1 0 0;
#X connect 14 0 12 0;
#X connect 15 0 1 0;
#X connect 17 0 14 0;
#X restore 14 428 pd read_input_and_send_CONT;
#N canvas 1030 368 489 428 openpanel_and_toggle_edit_mode 0;
#X obj 57 103 r \$0-edit_mode;
#X obj 57 126 t b f;
#X msg 57 149 1;
#X obj 57 172 - 0;
#X obj 57 232 shmem 10999 1;
#X msg 57 195 memset 0 \$1;
#X obj 207 10 loadbang;
#X msg 137 195 memset 0 1;
#X obj 56 33 openpanel;
#X obj 56 10 r \$0-op-bang;
#X msg 56 56 symbol \$1;
#X obj 56 79 s \$0-pathname;
#X obj 142 33 symbol \$1;
#X obj 171 144 select 1;
#X obj 171 167 s \$0-start;
#X obj 207 33 t b b b b;
#X msg 258 68 1;
#X symbolatom 142 60 10 0 0 0 - - -;
#X obj 171 119 f \$2 0;
#X obj 235 102 s \$0-poll-msgs-in;
#X obj 353 101 s \$0-poll-procs-in;
#X connect 0 0 1 0;
#X connect 1 0 2 0;
#X connect 1 1 3 1;
#X connect 2 0 3 0;
#X connect 3 0 5 0;
#X connect 5 0 4 0;
#X connect 6 0 15 0;
#X connect 7 0 4 0;
#X connect 8 0 10 0;
#X connect 9 0 8 0;
#X connect 10 0 11 0;
#X connect 12 0 17 0;
#X connect 13 0 14 0;
#X connect 15 0 18 0;
#X connect 15 1 7 0;
#X connect 15 2 12 0;
#X connect 15 3 16 0;
#X connect 16 0 19 0;
#X connect 16 0 20 0;
#X connect 17 0 10 0;
#X connect 18 0 13 0;
#X restore 261 429 pd openpanel_and_toggle_edit_mode;
#N canvas 1523 85 395 448 start_processes 0;
#X obj 139 237 ggee/shell;
#X obj 90 306 pack f f;
#X obj 90 336 route 0;
#X obj 57 280 t b f;
#X obj 57 306 f 0;
#X msg 56 337 1;
#X text 16 259 pass float once only;
#X obj 90 373 s \$0-pid;
#X obj 166 334 spigot 0;
#X obj 139 260 t l l;
#X msg 211 309 0;
#X text 243 309 reset;
#X msg 69 203 /bin/bash batchmgmt-wrapper.sh $_ \$1 \$2;
#X obj 231 149 pack s s;
#X obj 142 123 symbol -batch;
#X obj 189 34 select 0 1;
#X obj 230 121 r \$0-pathname;
#X obj 189 8 r \$0-edit_mode;
#X obj 71 92 r \$0-start;
#X symbolatom 141 149 10 0 0 0 - - -;
#X obj 125 62 symbol -batch;
#X obj 217 62 symbol -noaudio;
#X text 205 222 $_ is pd full path;
#X obj 166 374 outlet;
#X msg 298 294 1;
#X obj 298 317 s \$0-stopped;
#X obj 71 145 t b b b;
#X msg 332 195 0;
#X msg 294 401 0;
#X obj 294 424 s \$0-suspended;
#X obj 293 374 s \$0-running;
#X msg 293 351 0;
#X connect 0 0 9 0;
#X connect 0 1 24 0;
#X connect 0 1 31 0;
#X connect 0 1 28 0;
#X connect 1 0 2 0;
#X connect 2 0 5 0;
#X connect 2 0 7 0;
#X connect 3 0 4 0;
#X connect 3 1 1 1;
#X connect 4 0 1 0;
#X connect 5 0 4 1;
#X connect 5 0 8 1;
#X connect 8 0 23 0;
#X connect 9 0 3 0;
#X connect 9 1 8 0;
#X connect 10 0 8 1;
#X connect 10 0 4 1;
#X connect 12 0 0 0;
#X connect 13 0 12 0;
#X connect 14 0 19 0;
#X connect 15 0 20 0;
#X connect 15 1 21 0;
#X connect 16 0 13 1;
#X connect 17 0 15 0;
#X connect 18 0 26 0;
#X connect 19 0 13 0;
#X connect 20 0 14 1;
#X connect 21 0 14 1;
#X connect 24 0 25 0;
#X connect 26 0 14 0;
#X connect 26 1 10 0;
#X connect 26 2 27 0;
#X connect 27 0 25 0;
#X connect 28 0 29 0;
#X connect 31 0 30 0;
#X restore 521 406 pd start_processes;
#X text 567 432 collect stdout (not working);
#X obj 296 279 tgl 15 0 empty \$0-stopped empty 17 7 0 10 -262144 -1
-1 0 1;
#X text 316 277 stopped;
#X obj 296 259 tgl 15 0 empty \$0-suspended empty 17 7 0 10 -262144
-1 -1 0 1;
#X obj 296 239 tgl 15 0 empty \$0-running empty 17 7 0 10 -262144 -1
-1 0 1;
#X text 316 237 running;
#X text 316 257 suspended;
#X text 256 15 optional arguments choose patch and start;
#X text 271 157 on/off accept new connections;
#X obj 253 182 tgl 15 1 \$0-poll-msgs \$0-poll-msgs-in empty 17 7 0
10 -262144 -1 -1 1 1;
#X text 273 180 on/off poll for messages;
#X obj 679 404 declare -path ggee;
#X obj 799 404 declare -path shmem;
#X connect 9 0 44 0;
#X connect 43 0 41 0;
#X connect 46 0 42 0;
#X coords 0 -1 1 1 400 250 1 50 50;
